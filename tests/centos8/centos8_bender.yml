---
- name: download_binary test 
  hosts: all
  vars:

    cli:
      helm:
        source_link: "https://get.helm.sh/helm-v3.0.2-linux-amd64.tar.gz"
        dir_to_copy: "/tmp/linux-amd64/helm"
        dir_to_delete: "/tmp/linux-amd64"
        bin_dir: "/usr/bin/"
      terraform:
        source_link: "https://releases.hashicorp.com/terraform/0.12.8/terraform_0.12.8_linux_amd64.zip"
        dir_to_copy: "/tmp/terraform"
        dir_to_delete: "/tmp/terraform"
        bin_dir: "/usr/bin/"
      awsprovider:
        source_link: "https://releases.hashicorp.com/terraform-provider-aws/2.27.0/terraform-provider-aws_2.27.0_linux_amd64.zip"
        dir_to_copy: "/tmp/terraform-provider-aws_v2.27.0_x4"
        dir_to_delete: "/tmp/terraform-provider-aws_v2.27.0_x4"
        bin_dir: "/usr/bin/"
      velero:
        source_link: "https://github.com/vmware-tanzu/velero/releases/download/v1.3.1/velero-v1.3.1-linux-amd64.tar.gz"
        dir_to_copy: "/tmp/velero-v1.3.1-linux-amd64/velero"
        dir_to_delete: "/tmp/velero-v1.3.1-linux-amd64"
        bin_dir: "/usr/bin/"

    ansible_bender:
      base_image: centos8:python

      working_container:
        volumes:
          - '{{ playbook_dir }}:/src'

      target_image:
        name: centos8:download_binary
        working_dir: /src
        labels:
          built-by: '{{ ansible_user }}'
        environment:
          FILE_TO_PROCESS: README.md

  roles:
    - install-os-packages

  tasks:
    - name: call role download_binary in a loop
      include_role:
        name: download_binary
      loop: "{{ lookup('dict', cli) }}"
