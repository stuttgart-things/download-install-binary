---
- name: download_binary test
  hosts: all
  vars:

    cli:
      helm:
        bin_name: "helm"
        bin_version: "3.0.2"
        check_bin_version_before_installing: true
        source_url: "https://get.helm.sh/helm-v3.0.2-linux-amd64.tar.gz"
        bin_to_copy: "linux-amd64/helm"
        to_remove: "linux-amd64"
        bin_dir: "/usr/local/bin"
      terraform:
        bin_name: "terraform"
        bin_version: "0.12.8"
        check_bin_version_before_installing: true
        source_link: "https://releases.hashicorp.com/terraform/0.12.8/terraform_0.12.8_linux_amd64.zip"
        dir_to_copy: "terraform"
        dir_to_delete: "terraform"
        bin_dir: "/usr/local/bin"
      awsprovider:
        bin_name: "awsprovider"
        bin_version: "2.27.0"
        check_bin_version_before_installing: true
        source_link: "https://releases.hashicorp.com/terraform-provider-aws/2.27.0/terraform-provider-aws_2.27.0_linux_amd64.zip"
        dir_to_copy: "terraform-provider-aws_v2.27.0_x4"
        dir_to_delete: "terraform-provider-aws_v2.27.0_x4"
        bin_dir: "/usr/local/bin"
      velero:
        bin_name: "velero"
        bin_version: "1.3.1"
        check_bin_version_before_installing: true
        source_link: "https://github.com/vmware-tanzu/velero/releases/download/v1.3.1/velero-v1.3.1-linux-amd64.tar.gz"
        dir_to_copy: "velero-v1.3.1-linux-amd64/velero"
        dir_to_delete: "velero-v1.3.1-linux-amd64"
        bin_dir: "/usr/local/bin"

    ansible_bender:
      base_image: centos8:python

      working_container:
        volumes:
          - '{{ playbook_dir }}:/src'

      target_image:
        name: centos8:download_binary
        working_dir: /src
        labels:
          built-by: '{{ ansible_user }}'
        environment:
          FILE_TO_PROCESS: README.md

  roles:
    - install-os-packages

  tasks:
    - name: Start testing download_binary in a loop
      include_role:
        name: download_binary
      loop: "{{ lookup('dict', cli, wantlist=True) }}"
